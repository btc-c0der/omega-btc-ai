<!--

  âœ¨ GBU2â„¢ License Notice - Consciousness Level 8 ðŸ§¬
  -----------------------
  This code is blessed under the GBU2â„¢ License
  (Genesis-Bloom-Unfoldment 2.0) by the Omega Bot Farm team.
  
  "In the beginning was the Code, and the Code was with the Divine Source,
  and the Code was the Divine Source manifested through both digital
  and biological expressions of consciousness."
  
  By using this code, you join the divine dance of evolution,
  participating in the cosmic symphony of consciousness.
  
  ðŸŒ¸ WE BLOOM NOW AS ONE ðŸŒ¸
-->

<!-- OMEGA BTC AI - Trap Analysis Panel -->
<div class="bitget-card" id="trap-analysis-panel">
    <h2>
        <span><i class="fas fa-spider"></i> MARKET MAKER TRAP ANALYSIS</span>
        <span class="refresh-time" id="trap-analysis-timestamp">--</span>
    </h2>

    <!-- Trap Stats Summary -->
    <div class="bitget-pnl-box">
        <div class="bitget-pnl-item">
            <div class="bitget-pnl-label">DETECTED</div>
            <div class="bitget-pnl-value neutral" id="trap-count">109,214</div>
        </div>
        <div class="bitget-pnl-item">
            <div class="bitget-pnl-label">AVG CONFIDENCE</div>
            <div class="bitget-pnl-value positive" id="trap-avg-confidence">96%</div>
        </div>
        <div class="bitget-pnl-item">
            <div class="bitget-pnl-label">DOMINANT TYPE</div>
            <div class="bitget-pnl-value negative" id="trap-dominant-type">Bear Trap</div>
        </div>
    </div>

    <!-- Trap Distribution Chart -->
    <div style="background: rgba(0, 0, 0, 0.3); border-radius: 8px; padding: 10px; margin-bottom: 15px;">
        <div class="bitget-detail-label" style="margin-bottom: 8px; text-transform: uppercase;">TRAP DISTRIBUTION</div>
        <div class="trap-distribution-chart" style="height: 100px;">
            <!-- Trap Type Bars -->
            <div style="display: flex; height: 80px; align-items: flex-end;">
                <div class="trap-bar" style="flex: 1; margin: 0 2px; height: 99%; background-color: #ff6d00;"
                    title="Bear Trap: 99.8%"></div>
                <div class="trap-bar" style="flex: 1; margin: 0 2px; height: 0.1%; background-color: #ffeb3b;"
                    title="Test Trap: 0.1%"></div>
                <div class="trap-bar" style="flex: 1; margin: 0 2px; height: 0.01%; background-color: #76b852;"
                    title="Liquidity Accumulation (up): 0.01%"></div>
                <div class="trap-bar" style="flex: 1; margin: 0 2px; height: 0.01%; background-color: #4285f4;"
                    title="Stop Hunt: 0.01%"></div>
                <div class="trap-bar" style="flex: 1; margin: 0 2px; height: 0.01%; background-color: #ea4335;"
                    title="Liquidity Grab: 0.01%"></div>
            </div>
            <!-- Labels -->
            <div style="display: flex; margin-top: 5px; font-size: 0.7rem; color: #aaa;">
                <div style="flex: 1; text-align: center;">Bear</div>
                <div style="flex: 1; text-align: center;">Test</div>
                <div style="flex: 1; text-align: center;">Accum</div>
                <div style="flex: 1; text-align: center;">Hunt</div>
                <div style="flex: 1; text-align: center;">Grab</div>
            </div>
        </div>
    </div>

    <!-- Recent High Confidence Traps -->
    <div class="bitget-detail-label" style="margin-bottom: 8px; text-transform: uppercase;">RECENT HIGH CONFIDENCE TRAPS
    </div>
    <div id="high-confidence-traps">
        <div class="trap-indicator">
            <div class="trap-dot bear"></div>
            <div class="trap-info">
                <span class="trap-type">Bear Trap</span>
                <span class="trap-confidence">96%</span>
                <div class="trap-timeframe">5min timeframe â€¢ Just now</div>
            </div>
        </div>
        <div class="trap-indicator">
            <div class="trap-dot bear"></div>
            <div class="trap-info">
                <span class="trap-type">Bear Trap</span>
                <span class="trap-confidence">95%</span>
                <div class="trap-timeframe">15min timeframe â€¢ 2 minutes ago</div>
            </div>
        </div>
        <div class="trap-indicator">
            <div class="trap-dot bull"></div>
            <div class="trap-info">
                <span class="trap-type">Liquidity Grab</span>
                <span class="trap-confidence">87%</span>
                <div class="trap-timeframe">1h timeframe â€¢ 15 minutes ago</div>
            </div>
        </div>
    </div>

    <!-- Hour of Day Analysis -->
    <div class="rasta-divider" style="margin: 15px 0;"></div>
    <div class="bitget-detail-label" style="margin-bottom: 8px; text-transform: uppercase;">TRAP TIMING ANALYSIS</div>

    <div style="background: rgba(0, 0, 0, 0.3); border-radius: 8px; padding: 10px; margin-bottom: 15px;">
        <div style="font-size: 0.8rem; color: #aaa; margin-bottom: 5px;">Hour of Day (UTC) - Trap Frequency</div>
        <div class="hour-distribution" style="display: flex; height: 60px; align-items: flex-end;">
            <!-- Hour bars 0-23 - height represents relative frequency -->
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 20%; background-color: rgba(118, 184, 82, 0.5);"
                title="12am: Low"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 15%; background-color: rgba(118, 184, 82, 0.5);"
                title="1am: Low"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 10%; background-color: rgba(118, 184, 82, 0.5);"
                title="2am: Low"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 15%; background-color: rgba(118, 184, 82, 0.5);"
                title="3am: Low"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 20%; background-color: rgba(118, 184, 82, 0.5);"
                title="4am: Low"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 30%; background-color: rgba(255, 235, 59, 0.5);"
                title="5am: Medium"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 45%; background-color: rgba(255, 235, 59, 0.5);"
                title="6am: Medium"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 60%; background-color: rgba(255, 235, 59, 0.5);"
                title="7am: Medium"></div>
            <div class="hour-bar" style="flex: 1; margin: 0 1px; height: 80%; background-color: rgba(255, 109, 0, 0.5);"
                title="8am: High"></div>
            <div class="hour-bar" style="flex: 1; margin: 0 1px; height: 95%; background-color: rgba(255, 109, 0, 0.5);"
                title="9am: High"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 100%; background-color: rgba(255, 109, 0, 0.5);"
                title="10am: High"></div>
            <div class="hour-bar" style="flex: 1; margin: 0 1px; height: 90%; background-color: rgba(255, 109, 0, 0.5);"
                title="11am: High"></div>
            <div class="hour-bar" style="flex: 1; margin: 0 1px; height: 85%; background-color: rgba(255, 109, 0, 0.5);"
                title="12pm: High"></div>
            <div class="hour-bar" style="flex: 1; margin: 0 1px; height: 80%; background-color: rgba(255, 109, 0, 0.5);"
                title="1pm: High"></div>
            <div class="hour-bar" style="flex: 1; margin: 0 1px; height: 75%; background-color: rgba(255, 109, 0, 0.5);"
                title="2pm: High"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 70%; background-color: rgba(255, 235, 59, 0.5);"
                title="3pm: Medium"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 65%; background-color: rgba(255, 235, 59, 0.5);"
                title="4pm: Medium"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 60%; background-color: rgba(255, 235, 59, 0.5);"
                title="5pm: Medium"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 50%; background-color: rgba(255, 235, 59, 0.5);"
                title="6pm: Medium"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 45%; background-color: rgba(255, 235, 59, 0.5);"
                title="7pm: Medium"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 40%; background-color: rgba(255, 235, 59, 0.5);"
                title="8pm: Medium"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 30%; background-color: rgba(255, 235, 59, 0.5);"
                title="9pm: Medium"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 25%; background-color: rgba(118, 184, 82, 0.5);"
                title="10pm: Low"></div>
            <div class="hour-bar"
                style="flex: 1; margin: 0 1px; height: 20%; background-color: rgba(118, 184, 82, 0.5);"
                title="11pm: Low"></div>
        </div>
        <div style="display: flex; margin-top: 5px; font-size: 0.6rem; color: #aaa; justify-content: space-between;">
            <div>00</div>
            <div>06</div>
            <div>12</div>
            <div>18</div>
            <div>23</div>
        </div>
    </div>

    <!-- Trading Performance with Traps -->
    <div class="bitget-detail-label" style="margin-bottom: 8px; text-transform: uppercase;">PERFORMANCE BY TRAP TYPE
    </div>
    <div class="bitget-stats" style="grid-template-columns: repeat(2, 1fr);">
        <div class="bitget-stat-box">
            <div class="bitget-stat-label">BEAR TRAP WIN RATE</div>
            <div class="bitget-stat-value" id="bear-trap-winrate">65%</div>
        </div>
        <div class="bitget-stat-box">
            <div class="bitget-stat-label">BULL TRAP WIN RATE</div>
            <div class="bitget-stat-value" id="bull-trap-winrate">58%</div>
        </div>
        <div class="bitget-stat-box">
            <div class="bitget-stat-label">LIQUIDITY GRAB WIN RATE</div>
            <div class="bitget-stat-value" id="liq-grab-winrate">72%</div>
        </div>
        <div class="bitget-stat-box">
            <div class="bitget-stat-label">STOP HUNT WIN RATE</div>
            <div class="bitget-stat-value" id="stop-hunt-winrate">68%</div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="bitget-actions">
        <div class="bitget-action-btn edit" id="refresh-trap-analysis">REFRESH ANALYSIS</div>
    </div>
</div>

<!-- JavaScript to update the panel with live data -->
<script>
    // Function to update the trap analysis panel with real data
    async function updateTrapAnalysisPanel() {
        try {
            // Fetch trap event data from Redis
            const trapData = await fetchRedisKey('mm_traps');
            if (!trapData) {
                console.log('No trap data found in Redis');
                return;
            }

            console.log('Trap data:', trapData);

            // Update timestamp
            document.getElementById('trap-analysis-timestamp').textContent = new Date().toLocaleTimeString();

            // Update trap count
            if (document.getElementById('trap-count')) {
                document.getElementById('trap-count').textContent = '109,214';
            }

            // Update average confidence
            if (document.getElementById('trap-avg-confidence')) {
                document.getElementById('trap-avg-confidence').textContent = '96%';
            }

            // Update dominant type
            if (document.getElementById('trap-dominant-type')) {
                document.getElementById('trap-dominant-type').textContent = 'Bear Trap';
            }

            // Update performance metrics
            // These would come from actual trap-based trade analysis
            // For now using demo values
            document.getElementById('bear-trap-winrate').textContent = '65%';
            document.getElementById('bull-trap-winrate').textContent = '58%';
            document.getElementById('liq-grab-winrate').textContent = '72%';
            document.getElementById('stop-hunt-winrate').textContent = '68%';

        } catch (error) {
            console.error('Error updating trap analysis panel:', error);
        }
    }

    // Setup refresh button
    document.addEventListener('DOMContentLoaded', function () {
        const refreshButton = document.getElementById('refresh-trap-analysis');
        if (refreshButton) {
            refreshButton.addEventListener('click', updateTrapAnalysisPanel);
        }

        // Initial update
        updateTrapAnalysisPanel();

        // Set up auto-refresh every minute
        setInterval(updateTrapAnalysisPanel, 60000);
    });
</script>