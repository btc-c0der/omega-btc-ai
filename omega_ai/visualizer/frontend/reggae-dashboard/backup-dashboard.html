<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMEGA BTC AI - Reggae Dashboard (Backup)</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #121212;
            color: #E0E0E0;
            margin: 0;
            padding: 20px;
        }

        .header {
            background-color: #1E1E1E;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #FFD700;
            margin: 0;
        }

        .connection-status {
            display: flex;
            align-items: center;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .connected {
            background-color: #00B52D;
        }

        .disconnected {
            background-color: #FF3D00;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr 1fr;
            }
        }

        .card {
            background-color: #1E1E1E;
            border: 1px solid rgba(255, 215, 0, 0.2);
            padding: 20px;
            border-radius: 5px;
        }

        .card h2 {
            color: #FFD700;
            margin-top: 0;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            padding-bottom: 10px;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            border-bottom: 1px dotted rgba(255, 255, 255, 0.1);
            padding-bottom: 5px;
        }

        .label {
            color: #AAAAAA;
        }

        .value {
            font-weight: bold;
        }

        .value.positive {
            color: #00B52D;
        }

        .value.negative {
            color: #FF3D00;
        }

        .value.neutral {
            color: #FFD700;
        }

        .progress-bar {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            height: 20px;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-bar-inner {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .jah-message {
            background: linear-gradient(to right, rgba(0, 181, 45, 0.2), rgba(255, 221, 0, 0.2), rgba(255, 61, 0, 0.2));
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            color: #FFD700;
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>OMEGA BTC AI ðŸ”± REGGAE DASHBOARD</h1>
        <div class="connection-status">
            <div id="status-indicator" class="status-indicator disconnected"></div>
            <span id="status-text">Disconnected</span>
        </div>
    </div>

    <div class="dashboard">
        <div class="card">
            <h2>TRAP PROBABILITY</h2>
            <div class="data-row">
                <span class="label">Probability:</span>
                <span id="trap-probability" class="value neutral">0%</span>
            </div>
            <div class="data-row">
                <span class="label">Type:</span>
                <span id="trap-type" class="value neutral">Unknown</span>
            </div>
            <div class="data-row">
                <span class="label">Trend:</span>
                <span id="trap-trend" class="value neutral">Stable</span>
            </div>
            <div class="data-row">
                <span class="label">Confidence:</span>
                <span id="trap-confidence" class="value neutral">0%</span>
            </div>
            <div class="progress-bar">
                <div id="trap-bar" class="progress-bar-inner" style="width: 0%; background-color: #FFD700;"></div>
            </div>
            <div id="jah-message" class="jah-message">
                JAH GUIDES THE TRADING PATH!
            </div>
        </div>

        <div class="card">
            <h2>POSITION DATA</h2>
            <div class="data-row">
                <span class="label">Status:</span>
                <span id="position-status" class="value neutral">No Position</span>
            </div>
            <div class="data-row">
                <span class="label">Side:</span>
                <span id="position-side" class="value neutral">N/A</span>
            </div>
            <div class="data-row">
                <span class="label">Entry Price:</span>
                <span id="entry-price" class="value neutral">$0.00</span>
            </div>
            <div class="data-row">
                <span class="label">Current Price:</span>
                <span id="current-price" class="value neutral">$0.00</span>
            </div>
            <div class="data-row">
                <span class="label">PnL (%):</span>
                <span id="pnl-percent" class="value neutral">0.00%</span>
            </div>
            <div class="data-row">
                <span class="label">PnL (USD):</span>
                <span id="pnl-usd" class="value neutral">$0.00</span>
            </div>
            <div class="data-row">
                <span class="label">Position Size:</span>
                <span id="position-size" class="value neutral">0.00 BTC</span>
            </div>
            <div class="data-row">
                <span class="label">Updated:</span>
                <span id="position-timestamp" class="value neutral">N/A</span>
            </div>
        </div>
    </div>

    <script>
        // Format numbers with commas
        const formatNumber = (num) => {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        };

        // Format USD values
        const formatUSD = (num) => {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(num);
        };

        // Format BTC values
        const formatBTC = (num) => {
            return num.toFixed(4) + ' BTC';
        };

        // Format percentage values
        const formatPercent = (num) => {
            return num.toFixed(2) + '%';
        };

        // Format timestamp
        const formatTimestamp = (timestamp) => {
            const date = new Date(timestamp);
            return date.toLocaleTimeString();
        };

        // Update connection status
        const updateConnectionStatus = (connected) => {
            const indicator = document.getElementById('status-indicator');
            const text = document.getElementById('status-text');

            if (connected) {
                indicator.classList.remove('disconnected');
                indicator.classList.add('connected');
                text.textContent = 'Connected';
            } else {
                indicator.classList.remove('connected');
                indicator.classList.add('disconnected');
                text.textContent = 'Disconnected';
            }
        };

        // Update trap probability data
        const updateTrapData = (data) => {
            document.getElementById('trap-probability').textContent = formatPercent(data.probability * 100);
            document.getElementById('trap-type').textContent = data.trap_type || 'Unknown';
            document.getElementById('trap-trend').textContent = (data.trend || 'stable').replace('_', ' ');
            document.getElementById('trap-confidence').textContent = formatPercent((data.confidence || 0) * 100);

            const trapBar = document.getElementById('trap-bar');
            trapBar.style.width = `${data.probability * 100}%`;

            // Set color based on probability
            if (data.probability < 0.3) {
                trapBar.style.backgroundColor = '#00B52D'; // Green for low probability
            } else if (data.probability < 0.7) {
                trapBar.style.backgroundColor = '#FFD700'; // Yellow for medium probability
            } else {
                trapBar.style.backgroundColor = '#FF3D00'; // Red for high probability
            }

            // Update JAH message
            if (data.message) {
                document.getElementById('jah-message').textContent = data.message;
            }
        };

        // Update position data
        const updatePositionData = (data) => {
            const hasPosition = data.has_position || false;

            document.getElementById('position-status').textContent = hasPosition ? 'Active' : 'No Position';
            document.getElementById('position-side').textContent = data.position_side || 'N/A';
            document.getElementById('entry-price').textContent = data.entry_price ? formatUSD(data.entry_price) : 'N/A';
            document.getElementById('current-price').textContent = data.current_price ? formatUSD(data.current_price) : 'N/A';

            const pnlPercent = document.getElementById('pnl-percent');
            if (data.pnl_percent) {
                pnlPercent.textContent = formatPercent(data.pnl_percent);
                if (data.pnl_percent > 0) {
                    pnlPercent.className = 'value positive';
                } else if (data.pnl_percent < 0) {
                    pnlPercent.className = 'value negative';
                } else {
                    pnlPercent.className = 'value neutral';
                }
            } else {
                pnlPercent.textContent = 'N/A';
                pnlPercent.className = 'value neutral';
            }

            const pnlUsd = document.getElementById('pnl-usd');
            if (data.pnl_usd) {
                pnlUsd.textContent = formatUSD(data.pnl_usd);
                if (data.pnl_usd > 0) {
                    pnlUsd.className = 'value positive';
                } else if (data.pnl_usd < 0) {
                    pnlUsd.className = 'value negative';
                } else {
                    pnlUsd.className = 'value neutral';
                }
            } else {
                pnlUsd.textContent = 'N/A';
                pnlUsd.className = 'value neutral';
            }

            document.getElementById('position-size').textContent = data.position_size ? formatBTC(data.position_size) : 'N/A';
            document.getElementById('position-timestamp').textContent = data.timestamp ? formatTimestamp(data.timestamp) : 'N/A';
        };

        // Fetch data from API
        const fetchData = async () => {
            try {
                // Fetch trap probability data
                const trapResponse = await fetch('http://localhost:8000/api/trap-probability');
                if (!trapResponse.ok) throw new Error('Failed to fetch trap data');
                const trapData = await trapResponse.json();
                updateTrapData(trapData);

                // Fetch position data
                const positionResponse = await fetch('http://localhost:8000/api/position');
                if (!positionResponse.ok) throw new Error('Failed to fetch position data');
                const positionData = await positionResponse.json();
                updatePositionData(positionData);

                // Update connection status
                updateConnectionStatus(true);
            } catch (error) {
                console.error('Error fetching data:', error);
                updateConnectionStatus(false);
            }
        };

        // Initial fetch
        fetchData();

        // Set up polling interval (every 2 seconds)
        setInterval(fetchData, 2000);
    </script>
</body>

</html>